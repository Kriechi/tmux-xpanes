language: bash
sudo: required
addons:
  apt:
    packages:
      - shellcheck
      - ncurses-dev
      - libevent-dev
      - gcc
      - make
      - curl

branches:
    only:
        - master
        - develop
        - /^develop-.*/
        - /^bugfix.*/
        - /^feature.*/

matrix:
    include:
          ## CASES are generated by pict and Pairwise technique. Refer to ./test/travis.pict.

        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.8 CASES=13,15,16,26,39,47,63,64
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9 CASES=14,20,24,27,41,44
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9a CASES=1,3,19,22,30,48,56
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.0 CASES=5,6,29,34,35,42,45,63
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.1 CASES=2,9,16,19,28,44,50,52
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.2 CASES=10,24,26,28,40,45,53,57,60
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.3 CASES=19,20,23,32,33,55,58,59,64,65
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.4 CASES=11,17,22,26,31,37,38,40
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.5 CASES=2,4,5,7,12,25,32,33,54,61
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.6 CASES=21,43,44,49,51,62
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.7 CASES=1,8,9,18,22,36,46,61,66
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.8 CASES=4,5,8,9,27,42,60
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9 CASES=4,7,19,21,23,37,40,49,56,57,61
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9a CASES=7,12,18,31,32,41,47,51,52,54
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.0 CASES=14,39,40,43,48,52
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.1 CASES=3,7,12,25,30,32,40,42,48,63,64
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.2 CASES=6,11,12,14,20,23,33,34,46,49,54,61
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.3 CASES=1,3,5,17,26,28,29,34,44,48,63
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.4 CASES=8,10,16,25,27,42,46,50,59
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.5 CASES=11,14,15,18,22,24,34,35,38,45,46,48,55,66
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.6 CASES=13,18,30,35,36,45,47,63
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.7 CASES=2,16,19,37,38,53,58,62,65
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.8 CASES=17,19,23,29,36,38,44,57
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9 CASES=12,18,29,32,34,45,48,51,52,60,63,64
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9a CASES=6,8,9,25,27,33,42,46,50,53,64
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.0 CASES=11,20,26,33,38,41,57
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.1 CASES=4,5,6,10,21,23,24,43,51,55,56
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.2 CASES=2,7,16,30,31,41,43,44,47,50,56
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.3 CASES=12,14,15,16,21,22,30,35,47
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.4 CASES=9,13,28,29,45,49,57,58,61,65
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.5 CASES=8,9,10,16,23,31,37,57
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.6 CASES=1,4,19,24,32,34,40,41,54,62
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.7 CASES=3,21,33,39,42,45,49,55,59,63,66
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.8 CASES=12,14,22,30,33,40,48,55
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9 CASES=5,8,16,28,31,38,50,53,54
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9a CASES=2,10,15,17,37,43
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.0 CASES=3,10,13,31,32,37,46,54,60,61
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.1 CASES=13,18,26,31,38,46
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.2 CASES=4,8,9,18,21,25,36,39,42
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.3 CASES=11,13,40,45,58
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.4 CASES=1,2,4,20,21,33,34,35,41,53,63
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.5 CASES=6,19,20,27,29,30,41,43,47,49,51
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.6 CASES=3,9,17,28,52,56,57,61,65,66
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.7 CASES=6,7,14,23,24,30,34,44,59,62,64
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.8 CASES=7,10,18,25,35
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9 CASES=2,3,15,17,22,35,36,39,42,46,55
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9a CASES=4,16,21,35,44,49,57,60,63
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.0 CASES=8,22,24,28,30,44,47,53
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.1 CASES=1,8,15,29,34,36,37,39,41,45,47,61
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.2 CASES=5,13,19,22,29,32,48,51,52,55
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.3 CASES=9,24,27,31,38
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.4 CASES=6,14,18,43,54,64,65
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.5 CASES=1,26,56,58,64,66
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.6 CASES=5,7,15,23,27,33,37,42,48,50,62
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.7 CASES=11,12,15,20,26,29,35,40,43,59
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.8 CASES=1,11,20,34,37,41,43,45,61
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9 CASES=6,26,33
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9a CASES=5,11,26,39,40,55
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.0 CASES=1,4,9,12,15,18,19,21,25,50,56
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.1 CASES=14,17,20,35,49,53,57
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.2 CASES=3,27,38,60
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.3 CASES=4,25,36,37,43,46,58
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.4 CASES=3,7,23,24,30,32,47,56,66
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.5 CASES=13,21,28,39,42,44,52,63,65
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.6 CASES=2,8,10,12,14,16,20,22,25,29,31,46,55,59,62,64
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.7 CASES=10,13,25,27,41,48,50,51,54,57
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.8 CASES=3,21,24,28,46
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.9 CASES=1,9,10,11,13,25,30,43,47
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.9a CASES=13,14,20,23,24,28,29,34,36,38,45,61
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.0 CASES=2,7,16,17,23,27,36,49,51,55,64
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.1 CASES=11,22,27,33,54,60
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.2 CASES=1,15,17,35,37,63,64
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.3 CASES=7,8,10,18,39,41,42,57,66
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.4 CASES=5,12,15,19,36,39,44,48,51,52,55,65
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.5 CASES=3,17,36,40,50,53,59
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.6 CASES=6,11,26,38,39,53,58,62
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.7 CASES=4,5,17,28,31,32,47,52,56

before_script:
  - export TMPDIR=$TRAVIS_BUILD_DIR/tmp
  - mkdir -p $TMPDIR
    # Remove default tmux
  - if which tmux ;then sudo mv -f `which tmux` `which tmux`.bak ;fi
  - ( cd "$TMPDIR" && curl -L "https://github.com/tmux/tmux/releases/download/${TMUX_VERSION}/tmux-${TMUX_VERSION}.tar.gz" | tar zxv && cd tmux-${TMUX_VERSION} && ./configure --prefix=${TMPDIR}; make && sudo make install )
  - if [[ "$SH" == "bash" && "$SH_VERSION" != "default" ]];then (cd "$TMPDIR" && curl "http://ftp.gnu.org/gnu/bash/bash-${SH_VERSION}.tar.gz" | tar xvz && cd bash* && ./configure; make && sudo make install && sudo mv /bin/bash /bin/bash.old && sudo cp ./bash /bin/bash ) ;fi
  - printf "set-window-option -g automatic-rename off\nset-option -g allow-rename off\n" >> "$HOME/.tmux.conf"
  - $SH ./test/test_generator.sh "${CASES}" > ./test/cases_pairwise.sh

script:
  - shellcheck ./bin/xpanes
  - PATH="${TMPDIR}/bin:${PATH}" $SH ./test/unitTest.sh
  - TRAVIS_BUILD_DIR="${TRAVIS_BUILD_DIR}" $SH ./test/cases_pairwise.sh
