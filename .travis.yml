language: bash
sudo: required
addons:
  apt:
    packages:
      - shellcheck
      - ncurses-dev
      - libevent-dev
      - gcc
      - make
      - curl

branches:
    only:
        - master
        - develop
        - /^develop-.*/
        - /^bugfix.*/
        - /^feature.*/

matrix:
    include:
          ## CASES are generated by pict and Pairwise technique. Refer to ./test/travis.pict.

        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.8 CASES=14,15,42,44,49,75,78
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9 CASES=4,6,8,15,16,18,35,39,47,52,54,56,68,76
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9a CASES=5,7,11,17,31,32,36,38,48,49,50,64
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.0 CASES=29,44,45,52,55,57,79
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.1 CASES=2,7,9,20,30,31,32,37,43,48,56,65,69,70,79
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.2 CASES=22,34,40,45,46,62,64
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.3 CASES=11,12,20,23,33,48,71,75,77
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.4 CASES=1,13,26,34,38,41,43,51,54,57,59,60,65,69
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.5 CASES=1,6,10,29,39,44,58,65,67,77
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.6 CASES=3,5,21,25,28,32,38,43,51,69,72,73,77,79
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.7 CASES=3,4,7,19,23,27,33,36,38,40,44,53,63,66
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.8 CASES=4,5,20,24,61,64,74
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.8 CASES=10,11,12,17,19,21,25,37,38,39,46,79
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9 CASES=5,7,21,28,29,36,42,43,48,51,64,65
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9a CASES=6,15,22,43,55,65
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.0 CASES=16,26,40,47,53
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.1 CASES=1,13,14,29,33,34,41,54,58,75
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.2 CASES=2,7,15,20,26,32,33,55,61,71,78
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.3 CASES=19,22,34,44,60,69,70,76
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.4 CASES=9,11,12,16,25,29,31,35,39,42,49,50,56,68
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.5 CASES=4,5,7,24,27,35,45,62,64
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.6 CASES=1,18,27,30,47,50,52,53,57,59,66,67,72,75,76
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.7 CASES=10,13,15,25,41,45,46,73,77
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.8 CASES=3,8,13,14,22,23,30,37,39,47,63,74
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.8 CASES=3,8,23,26,30,34,56
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9 CASES=1,19,20,27,38
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9a CASES=2,16,21,35,56,61,62,78,79
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.0 CASES=6,8,12,13,14,18,20,24,39,41,49,69,71,77
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.1 CASES=11,15,17,21,40,45,46,51,52,68,76
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.2 CASES=5,14,27,28,29,31,38,48,51,75
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.3 CASES=4,5,9,10,30,31,35,37,41,43,58,59,64
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.4 CASES=22,28,32,44,47,53,76,78
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.5 CASES=2,12,18,21,23,25,26,31,32,50,53,57,71,75,78
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.6 CASES=11,36,54,60,73
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.7 CASES=5,34,49,55,70,72,74,76,79
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.8 CASES=7,12,15,31,33,36,42,49,63,65,66,67
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.8 CASES=1,5,27,43,48,69,76
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9 CASES=9,13,26,41,57,58,61,77,78,79
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9a CASES=8,12,20,24,37,41,42,44,46,68,75,77
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.0 CASES=3,9,10,17,19,27,31,36,38,51,64,65,68,70,75,76
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.1 CASES=4,8,23,26,27,49,71,77
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.2 CASES=11,13,17,18,25,30,37,52,53,54,69,76
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.3 CASES=8,16,26,39
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.4 CASES=15,21,37,40,55,62,71
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.5 CASES=8,19,20,22,28,33,36,37,40,60
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.6 CASES=7,9,13,15,22,29,34,35,42,45,56,64,66,70
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.7 CASES=2,6,14,24,28,30,39,47,50,51,56,67,68,69,71,72,73
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.8 CASES=1,17,32,34,48,59,63,70,74
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.8 CASES=4,7,9,20,22,28,35,41,45
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9 CASES=10,12,23,33,44,50,53,55,62,71
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9a CASES=1,18,19,25,26,45,47,58,70
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.0 CASES=5,15,30,34,35,37,42,43,46,48,78
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.1 CASES=3,10,18,22,28,36,44,47,61,62,64
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.2 CASES=1,4,10,16,19,24,39,57,77,79
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.3 CASES=21,27,28,32,36,38,42,46,49,65,68,79
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.4 CASES=3,4,8,10,14,17,18,58,67,75,77,79
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.5 CASES=13,14,34,43,47,66,68,69
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.6 CASES=2,4,6,8,12,24,31,33,41,46,48,60,62,63,68,72,73,78
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.7 CASES=9,12,17,35,42,52,54,57,59,62
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.8 CASES=9,11,16,26,29,40,44,45,46,51,54,56,62,74,76
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.8 CASES=13,18,64,65,71,77
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9 CASES=14,17,22,25,34,69,70
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9a CASES=4,9,14,23,33,51,54,57,69,76
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.0 CASES=2,11,21,28,32,50,54,56,58,61,62
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.1 CASES=5,12,16,24,35,38,42,50,53,57
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.2 CASES=3,8,23,35,42,44,49,56,68
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.3 CASES=7,17,29,40,47,66,78
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.4 CASES=6,20,24,27,33,36,45,46,48,70
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.5 CASES=9,15,30,38,49,55,59,70,79
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.6 CASES=14,16,17,19,23,26,37,39,40,58,63,65,67,74
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.7 CASES=1,11,18,20,21,22,29,31,32,48,60,64,72,75,78
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.8 CASES=2,10,18,19,21,25,28,41,43,50,52,55,58,73
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.8 CASES=16,24,29,31,36,40,47,58,61,62,68,70
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.9 CASES=2,3,11,24,30,31,32,37,40,45,46,49,75
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.9a CASES=3,10,13,27,28,29,30,34,39,40,52,53,71
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.0 CASES=1,4,7,22,23,25,33
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.1 CASES=6,19,25,39,55,78
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.2 CASES=6,9,12,21,36,41,43,47,50,58,65,70
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.3 CASES=1,3,13,14,15,18,24,25,45,56,67
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.4 CASES=2,5,7,19,23,30,52,64,66
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.5 CASES=3,11,16,17,41,42,46,48,51,52,54,56,76
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.6 CASES=10,20,44,49,55,71,74
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.7 CASES=8,16,26,37,43,58,63,65
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.8 CASES=6,27,35,38,53,57,59,60,68,69,71,72,73,75,77,78,79

before_script:
  - export TMPDIR=$TRAVIS_BUILD_DIR/tmp
  - mkdir -p $TMPDIR
    # Remove default tmux
  - if which tmux ;then sudo mv -f `which tmux` `which tmux`.bak ;fi
  - ( cd "$TMPDIR" && curl -L "https://github.com/tmux/tmux/releases/download/${TMUX_VERSION}/tmux-${TMUX_VERSION}.tar.gz" | tar zxv && cd tmux-${TMUX_VERSION} && ./configure --prefix=${TMPDIR}; make && sudo make install )
  - if [[ "$SH" == "bash" && "$SH_VERSION" != "default" ]];then (cd "$TMPDIR" && curl "http://ftp.gnu.org/gnu/bash/bash-${SH_VERSION}.tar.gz" | tar xvz && cd bash* && ./configure; make && sudo make install && sudo mv /bin/bash /bin/bash.old && sudo cp ./bash /bin/bash ) ;fi
  - printf "set-window-option -g automatic-rename off\nset-option -g allow-rename off\n" >> "$HOME/.tmux.conf"
  - $SH ./test/test_generator.sh "${CASES}" > ./test/cases_pairwise.sh

script:
  - shellcheck ./bin/xpanes
  - PATH="${TMPDIR}/bin:${PATH}" $SH ./test/unitTest.sh
  - TRAVIS_BUILD_DIR="${TRAVIS_BUILD_DIR}" $SH ./test/cases_pairwise.sh
