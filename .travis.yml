language: bash
sudo: required
addons:
  apt:
    packages:
      - shellcheck
      - ncurses-dev
      - libevent-dev
      - gcc
      - make
      - curl

branches:
    only:
        - master
        - develop
        - /^develop-.*/
        - /^bugfix.*/
        - /^feature.*/

matrix:
    include:
          ## CASES are generated by pict and Pairwise technique. Refer to ./test/travis.pict.

        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.8 CASES=5,8,15,16,33,42,57,61
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9 CASES=1,11,16,18,24,25,39
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9a CASES=1,11,21,30,34,40,41,46,47,52,54,55
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.0 CASES=2,4,5,10,13,18,20,27,35,37,53,57
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.1 CASES=13,20,22,25,29,31,33,37,40,48,49,60
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.2 CASES=12,14,15,26,27,29,30,33,45,61
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.3 CASES=1,17,36,38,48,65,66
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.4 CASES=6,18,28,31,38,41,56,58,63
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.5 CASES=2,3,7,17,19,30,50,57
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.6 CASES=4,6,7,9,24,26,32,33,39,47,51,55,59
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.7 CASES=4,7,23,27,42,43,44,48,53,62,64
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.8 CASES=1,4,11,20,25,27,60
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9 CASES=7,12,15,21,22,23,26,30,37,42,44,47,48,52
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9a CASES=15,17,19,27,35,42,51,56,57
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.0 CASES=9,17,23,26,28,32,34,36,42,44,49,54,63
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.1 CASES=11,17,19,24,35,43,46,55
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.2 CASES=2,6,9,16,19,20,31,40,52,53,54,55,57,63,64
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.3 CASES=9,11,22,26,27,31,33,35,57,58,59,64
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.4 CASES=3,5,7,13,20,25,29,32,40,46,50,53
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.5 CASES=1,5,10,16,18,21,36,39,48,55,64
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.6 CASES=2,14,23,38,41,44,45,49,61,65,66
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.7 CASES=1,6,8,21,38,41,47,51,62
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.8 CASES=3,7,10,12,18,26,35,40,41,46,55,63
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9 CASES=3,8,10,29,32,41,56,57,64
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9a CASES=5,9,10,18,22,24,31,43,44,49,50,53
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.0 CASES=14,19,21,25,30,51
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.1 CASES=6,12,15,30,34,41,54,56
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.2 CASES=1,7,22,28,35,37,46,48,56,60
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.3 CASES=3,4,8,12,13,19,23,39,40,45
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.4 CASES=9,10,14,15,16,21,33,39,42,44,49,52,58,66
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.5 CASES=14,20,22,24,25,27,34,38,43,47,54,61,63
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.6 CASES=5,17,18,20,37,46,54,59,62
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.7 CASES=2,5,11,13,14,32,36,37,61,65
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.8 CASES=13,22,28,29,30,37,43,45
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9 CASES=5,6,19,27,35,38,46,51,53,63
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9a CASES=2,8,13,14,20,26,36,38,39,48,60
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.0 CASES=1,6,7,16,29,33,40,43,45,46,50,61,64
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.1 CASES=8,14,16,23,27,32,36,39,45,47,52,53,57,63
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.2 CASES=4,13,21,24,38,42,44,49
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.3 CASES=7,10,15,24,32,41,43,44,46,55
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.4 CASES=1,4,11,17,19,22,23,43,47
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.5 CASES=9,11,23,33,37,44,51,58,59,65
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.6 CASES=12,21,29,30,31,35,42,48,56,62,66
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.7 CASES=3,12,15,17,18,25,33,34,40,54
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.8 CASES=14,17,21,24,34,38,44,47
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9 CASES=2,33,34,36,40,43,54,55,61
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9a CASES=6,7,28,37,45,61,63,64
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.0 CASES=8,15,31,38,41,55,60
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.1 CASES=3,4,9,18,26,28,42,50,61
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.2 CASES=3,8,10,11,23,25,39,47,50
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.3 CASES=5,21,25,30,34,37,42
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.4 CASES=2,8,12,24,27,48,51,57,59,65
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.5 CASES=4,8,12,29,31,32,35,45,46,52,56,66
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.6 CASES=1,11,13,15,16,19,28,43,52,53,57,62,63
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.7 CASES=9,10,16,19,20,22,24,26,28,29,31,35,49,50,52,58
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.8 CASES=9,19,23,36,39,48,64
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9 CASES=4,9,13,14,17,20,28,31,45,49,50,60
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9a CASES=3,4,12,16,23,25,29,32,33
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.0 CASES=3,11,12,22,24,39,47,48,52,56
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.1 CASES=1,2,5,7,10,21,38,44,51,64
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.2 CASES=5,17,18,32,34,36,41,43,51
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.3 CASES=14,16,18,20,28,29,47,63
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.4 CASES=26,30,34,35,36,37,45,54,55,61,64
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.5 CASES=6,13,15,26,28,40,41,42,49,53,65
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.6 CASES=3,8,10,22,25,27,34,36,40,50,58,64
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.7 CASES=30,39,45,46,55,56,57,59,62,63,66

before_script:
  - export TMPDIR=$TRAVIS_BUILD_DIR/tmp
  - mkdir -p $TMPDIR
    # Remove default tmux
  - if which tmux ;then sudo mv -f `which tmux` `which tmux`.bak ;fi
  - ( cd "$TMPDIR" && curl -L "https://github.com/tmux/tmux/releases/download/${TMUX_VERSION}/tmux-${TMUX_VERSION}.tar.gz" | tar zxv && cd tmux-${TMUX_VERSION} && ./configure --prefix=${TMPDIR}; make && sudo make install )
  - if [[ "$SH" == "bash" && "$SH_VERSION" != "default" ]];then (cd "$TMPDIR" && curl "http://ftp.gnu.org/gnu/bash/bash-${SH_VERSION}.tar.gz" | tar xvz && cd bash* && ./configure; make && sudo make install && sudo mv /bin/bash /bin/bash.old && sudo cp ./bash /bin/bash ) ;fi
  - printf "set-window-option -g automatic-rename off\nset-option -g allow-rename off\n" >> "$HOME/.tmux.conf"
  - $SH ./test/test_generator.sh "${CASES}" > ./test/cases_pairwise.sh

script:
  - shellcheck ./bin/xpanes
  - PATH="${TMPDIR}/bin:${PATH}" $SH ./test/unitTest.sh
  - TRAVIS_BUILD_DIR="${TRAVIS_BUILD_DIR}" $SH ./test/cases_pairwise.sh
