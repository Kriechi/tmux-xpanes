language: bash
sudo: required
addons:
  apt:
    packages:
      - shellcheck
      - ncurses-dev
      - libevent-dev
      - gcc
      - make
      - curl

branches:
    only:
        - master
        - develop
        - /^develop-.*/
        - /^bugfix.*/
        - /^feature.*/

matrix:
    include:
          ## CASES are generated by pict and Pairwise technique. Refer to ./test/travis.pict.

        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.8 CASES=9,11,12,13,24,28,29,34,44
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9 CASES=6,8,10,12,17,19,22,23,32,33,37,42,46,47,48,61,70,75
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9a CASES=26,27,38,43,48,51,54,58,69,76,80
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.0 CASES=13,26,28,31,46,49,54,65,75,78
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.1 CASES=1,7,8,9,17,19,21,29,35,56,64,71,77
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.2 CASES=2,12,23,30,31,36,38,76
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.3 CASES=1,3,19,26,28,38,39,40,48,49,66,68
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.4 CASES=4,5,12,14,15,16,25,50,55,60
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.5 CASES=1,16,20,24,40,50,52,64
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.6 CASES=14,30,39,41,42,45,51,62,65,67,72,79
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.7 CASES=3,5,29,57,59
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.8 CASES=1,3,4,10,18,27,30,36,53,55,63,73,74,77,80
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.8 CASES=3,4,21,30,31,42,47,49,62,69,78
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9 CASES=13,18,29,30,57,65,76
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9a CASES=6,8,15,16,56,75
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.0 CASES=3,7,10,17,20,21,43,52,70
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.1 CASES=2,6,10,22,24,25,26,39,40,44,45,50,61,68,70
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.2 CASES=14,15,19,26,37,39,44,46,55,64,79
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.3 CASES=20,21,31,32,71,77
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.4 CASES=9,26,30,35,36,41,51,56,58,66,67,80
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.5 CASES=12,14,18,25,27,29,34,53,54,68,79
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.6 CASES=1,5,11,15,19,22,28,33,38,59,60,78
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.7 CASES=9,16,23,32,45,48,70,72,74,77,80
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.8 CASES=6,16,28,42,46,62,63,73,78
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.8 CASES=1,7,14,19,36,58,76,79
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9 CASES=2,9,21,27,28,31,36,38,64,79,80
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9a CASES=3,12,22,40,44,45,53,55,61
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.0 CASES=2,4,11,23,30,39,48,62,71
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.1 CASES=15,27,33,43,46,53,65
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.2 CASES=5,7,11,13,16,25,32,40,48,49,51,52,56,57,58,78
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.3 CASES=17,34,41,43,56,67,69
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.4 CASES=18,42,43,68,70,71,77
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.5 CASES=6,22,35,37,47,49,59,62,75,78
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.6 CASES=21,24,34,35,43,44,50,52,53,64,76
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.7 CASES=8,10,20,21,24,25,26,31,38,39,46,54,60,65,66,73,74
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.8 CASES=12,14,15,29,32,34,37,63,69,72,76,79
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.8 CASES=17,23,25,27,37,38,43,46,80
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9 CASES=1,24,34,39,49,50,51,55,58,78
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9a CASES=2,4,20,29,32,37,41,50,57,64,68,71,77,79
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.0 CASES=6,16,35,36,38,40,45,53,57,61,69
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.1 CASES=4,5,11,13,14,28,30,41,51,52
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.2 CASES=3,4,9,33,35,42,43,65,69,70
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.3 CASES=7,9,10,12,15,22,33,44,46,59,65,70,75,76
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.4 CASES=1,7,11,13,19,20,23,31,40,48,62
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.5 CASES=8,11,15,26,33,39,45,58,60,76,80
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.6 CASES=4,13,17,25,27,55,63,66,72,73,74,75
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.7 CASES=4,14,18,28,40,47,50,56,64,67,68
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.8 CASES=8,17,19,21,22,23,25,38,49,52,54,56,57,64,65,71
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.8 CASES=8,26,35,45,48,64,70
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9 CASES=3,4,11,14,15,16,25,41,44,56,62,68,69,77
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9a CASES=7,14,31,33,34,35,39,42,47
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.0 CASES=1,19,22,32,47,51,56
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.1 CASES=12,16,32,34,49,54
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.2 CASES=1,8,10,21,24,41,54,68,71,77,80
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.3 CASES=11,23,27,29,30,36,47,78,80
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.4 CASES=3,6,8,17,24,37,47,52,57,59,64,79
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.5 CASES=2,3,9,13,28,31,32,38,41,43,46,51,65,66,70
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.6 CASES=6,8,18,20,23,37,40,47,58,72
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.7 CASES=2,7,11,13,30,34,37,49,52,53,55,60,63,71,75,76,78,79
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.8 CASES=5,20,31,40,44,45,50,61,67,73,74
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.8 CASES=10,15,40,41,68,71,75
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9 CASES=5,7,20,35,43,52,53,54
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9a CASES=1,9,10,13,18,30,65,78
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.0 CASES=5,8,9,18,25,27,29,33,34,37,44,50,77
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.1 CASES=3,20,23,36,37,47,55,58,69,75,79,80
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.2 CASES=17,18,27,28,45,47,61
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.3 CASES=4,13,14,18,24,42,58,64,67
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.4 CASES=2,21,22,27,28,33,34,38,44,46,49,53,66,69,76
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.5 CASES=7,10,17,19,21,36,42,44,48,56,57,69
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.6 CASES=12,16,26,29,31,32,36,56,70,80
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.7 CASES=6,12,15,35,51,62,69,73,74
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.8 CASES=9,11,24,26,35,39,41,48,59,60,63,72
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.8 CASES=5,16,18,20,22,39,56,61,65,77
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.9 CASES=26,40,45,71
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.9a CASES=5,11,17,19,21,23,24,25,28,36,46,49,52,62,70
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.0 CASES=12,14,15,24,41,42,55,58,64,68,76,79,80
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.1 CASES=18,31,38,42,48,57,62,76,78
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.2 CASES=6,20,22,29,34,50,53,62,75
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.3 CASES=5,8,16,25,35,37,45,60,79
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.4 CASES=10,29,32,39,45,54,65,75,78
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.5 CASES=4,5,23,30,55,67,71,77
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.6 CASES=2,3,7,9,10,46,48,49,54,57,59,68,69,71,74,77
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.7 CASES=1,17,19,22,27,33,36,41,42,43,44,58,73
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.8 CASES=2,7,13,33,43,47,51,58,63,66,68,70,72,75

before_script:
  - export TMPDIR=$TRAVIS_BUILD_DIR/tmp
  - mkdir -p $TMPDIR
    # Remove default tmux
  - if which tmux ;then sudo mv -f `which tmux` `which tmux`.bak ;fi
  - ( cd "$TMPDIR" && curl -L "https://github.com/tmux/tmux/releases/download/${TMUX_VERSION}/tmux-${TMUX_VERSION}.tar.gz" | tar zxv && cd tmux-${TMUX_VERSION} && ./configure --prefix=${TMPDIR}; make && sudo make install )
  - if [[ "$SH" == "bash" && "$SH_VERSION" != "default" ]];then (cd "$TMPDIR" && curl "http://ftp.gnu.org/gnu/bash/bash-${SH_VERSION}.tar.gz" | tar xvz && cd bash* && ./configure; make && sudo make install && sudo mv /bin/bash /bin/bash.old && sudo cp ./bash /bin/bash ) ;fi
  - printf "set-window-option -g automatic-rename off\nset-option -g allow-rename off\n" >> "$HOME/.tmux.conf"
  - $SH ./test/test_generator.sh "${CASES}" > ./test/cases_pairwise.sh

script:
  - shellcheck ./bin/xpanes
  - PATH="${TMPDIR}/bin:${PATH}" $SH ./test/unitTest.sh
  - TRAVIS_BUILD_DIR="${TRAVIS_BUILD_DIR}" $SH ./test/cases_pairwise.sh
