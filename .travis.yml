language: bash
sudo: required
addons:
  apt:
    packages:
      - shellcheck
      - ncurses-dev
      - libevent-dev
      - gcc
      - make
      - curl

branches:
    only:
        - master
        - develop
        - /^develop-.*/
        - /^bugfix.*/
        - /^feature.*/

matrix:
    include:
          ## CASES are generated by pict and Pairwise technique. Refer to ./test/travis.pict.

        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.8 CASES=3,5,24,33,45,77
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9 CASES=9,10,11,15,17,48
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9a CASES=7,16,24,32,35,38,44,49,52,53,54,55,56,63
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.0 CASES=7,10,12,14,21,22,23,29,37,38,39,41,44,60,63,75
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.1 CASES=6,18,19,36,39,48
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.2 CASES=2,26,32,39,40,46,51,56,57,68,77
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.3 CASES=12,30,34,36,57,58,65,67,74
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.4 CASES=3,10,15,21,23,39,50,55,66,68,75,76
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.5 CASES=1,7,13,29,31,41,49,54,59,69,77
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.6 CASES=8,20,22,27,30,38,42,43,45,47,51,64,67,72
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.7 CASES=19,21,25,28,37,57,62,69,70,71
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.8 CASES=2,4,11,14,26,37,40,49,55,57,61,73
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.8 CASES=1,9,10,13,21,36,42,48,75
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9 CASES=3,7,8,18,20,23,28,31,32,37,41,49,55,61,70,74
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9a CASES=5,14,19,29,42,46,69
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.0 CASES=16,18,33,35,42,45,54,67,77
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.1 CASES=12,21,29,30,38,44,46,74,76
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.2 CASES=11,34,38,45,52,60,63,64
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.3 CASES=8,15,22,24,25,28,29,40
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.4 CASES=5,9,34,43,51,53,56
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.5 CASES=17,19,24,39,50,51,52,66,67
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.6 CASES=2,4,13,23,25,26,41,44,57,62,68,70,75
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.7 CASES=4,6,11,18,27,45,47,65,71,72,73
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.8 CASES=1,3,7,19,23,24,27,58,59
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.8 CASES=23,37,39,40,44,46,64
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9 CASES=2,5,12,16,34,35,39,51,60,64,69
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9a CASES=3,15,17,20,22,26,43,47,48,57,74
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.0 CASES=1,17,20,31,40,48,50,51,61,68,69
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.1 CASES=4,22,23,25,77
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.2 CASES=3,6,10,15,28,29,37,42,47,49,70,75
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.3 CASES=3,5,11,13,23,33,43,46,76
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.4 CASES=2,11,14,16,17,19,27,36,41,45,54
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.5 CASES=8,18,20,21,26,28,30,38,56,61
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.6 CASES=12,28,34,35,40,46,48,53,55,59,65,66,69,71,72,73,77
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.7 CASES=7,9,22,24,31,39,48,52,55,58
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.8 CASES=13,25,32,35,41,50,62,63,67
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.8 CASES=7,11,16,20,35,47,60
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9 CASES=14,19,22,25,29,33,38,45,46,50,52,54,56,63,67
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9a CASES=4,8,9,21,23,25,28,68,70,75
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.0 CASES=11,13,24,28,74
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.1 CASES=7,9,16,20,26,27,41,43,51,57,61,63,64
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.2 CASES=5,12,14,36,44,67,69
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.3 CASES=1,18,32,48,55,64,66,69,70
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.4 CASES=12,24,28,30,40,44,46,47,57,59,61,74,77
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.5 CASES=6,9,10,27,35,37,45,48,75
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.6 CASES=1,15,17,19,31,33,39,56,58,62,65,71,74,76
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.7 CASES=2,3,8,10,13,32,34,44,49,53,63,72,73
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.8 CASES=12,17,18,22,34,36,42,43,76
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.8 CASES=15,22,25,27,28,30,69,74
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9 CASES=1,13,24,30,36,40,42,57,75
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9a CASES=2,11,12,30,34,41,45,50,60,76
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.0 CASES=2,4,27,32,43,47,55,64
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.1 CASES=8,13,14,15,24,32,34,37,49,54,56,67,68,75
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.2 CASES=4,8,16,17,19,21,27,31,48,50,61,74
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.3 CASES=7,10,20,27,35,37,38,39,44,59,63,68,77
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.4 CASES=1,7,18,20,26,29,31,37,52
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.5 CASES=4,5,23,25,33,34,40,47,53,57,58,65,76
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.6 CASES=3,5,6,18,29,49,52,63,71
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.7 CASES=12,14,16,20,42,43,46,51,56,61,62,64,67,74,76
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.8 CASES=6,9,16,33,46,53,66,68,70,72,73,75,77
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.8 CASES=4,12,14,18,19,26,29,38,57,63,67
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9 CASES=4,6,26,43,44,47,68,77
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9a CASES=10,13,18,27,36,37,39,40,51,67
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.0 CASES=5,8,9,25,34,49,52,53,56,70,76
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.1 CASES=3,5,10,17,31,42,50,52,55
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.2 CASES=1,20,24,30,33,41,43,55
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.3 CASES=16,19,21,31,41,47
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.4 CASES=4,6,8,35,63,65,69
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.5 CASES=2,3,11,15,22,32,42,46,55,70
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.6 CASES=7,11,21,32,36,58,61
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.7 CASES=15,23,26,33,35,40,41,54,59,62,66,75
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.8 CASES=5,8,10,21,28,29,31,45,48,54,60,64,71,72,73,74
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.8 CASES=8,17,34,41,43,55,61,68,70,76
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.9 CASES=21,27,53,76
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.9a CASES=1,6,31,33,61,64,77
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.0 CASES=3,6,15,19,26,30,36,46,57
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.1 CASES=1,2,11,28,33,35,40,45,47,53,60,69,70
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.2 CASES=7,9,13,18,22,23,25,35,53,54,76
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.3 CASES=4,9,14,17,26,42,45,66,75
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.4 CASES=13,22,25,32,33,38,42,48,49,58,64,67,70
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.5 CASES=12,14,16,36,43,44,63,64,68,74
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.6 CASES=9,10,14,16,24,37,50,54,72,73
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.7 CASES=1,5,17,29,30,36,38,50,68,71,77
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.8 CASES=15,20,30,38,39,44,47,51,52,56,59,62,65,69

before_script:
  - export TMPDIR=$TRAVIS_BUILD_DIR/tmp
  - mkdir -p $TMPDIR
    # Remove default tmux
  - if which tmux ;then sudo mv -f `which tmux` `which tmux`.bak ;fi
  - ( cd "$TMPDIR" && curl -L "https://github.com/tmux/tmux/releases/download/${TMUX_VERSION}/tmux-${TMUX_VERSION}.tar.gz" | tar zxv && cd tmux-${TMUX_VERSION} && ./configure --prefix=${TMPDIR}; make && sudo make install )
  - if [[ "$SH" == "bash" && "$SH_VERSION" != "default" ]];then (cd "$TMPDIR" && curl "http://ftp.gnu.org/gnu/bash/bash-${SH_VERSION}.tar.gz" | tar xvz && cd bash* && ./configure; make && sudo make install && sudo mv /bin/bash /bin/bash.old && sudo cp ./bash /bin/bash ) ;fi
  - printf "set-window-option -g automatic-rename off\nset-option -g allow-rename off\n" >> "$HOME/.tmux.conf"
  - $SH ./test/test_generator.sh "${CASES}" > ./test/cases_pairwise.sh

script:
  - shellcheck ./bin/xpanes
  - PATH="${TMPDIR}/bin:${PATH}" $SH ./test/unitTest.sh
  - TRAVIS_BUILD_DIR="${TRAVIS_BUILD_DIR}" $SH ./test/cases_pairwise.sh
